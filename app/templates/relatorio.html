{% extends "base.html" %}
{% block title %}Astral Report • SkyAI{% endblock %}
{% block body_class %}report-page{% endblock %}

{% block content %}
<style>
  .astro-box {
    max-width: 900px;
    margin: 2.5rem auto;
    padding: 2.5rem;
    background: #0b1f36;
    color: white;
    border-radius: 20px;
    box-shadow: 0 12px 28px rgba(0, 0, 0, 0.1);
    line-height: 1.7;
  }

  .astro-box h2 {
    color: #d4af37;
    font-size: 1.8rem;
    margin-bottom: 1.5rem;
    text-align: center;
  }

  .astro-box h3 {
    color: #ffdd77;
    margin-top: 2rem;
    font-size: 1.3rem;
  }

  .astro-box h4 {
    color: #FCE495;
    margin-top: 1.25rem;
    font-size: 1.1rem;
  }

  .astro-box ul {
    padding-left: 1.5rem;
    margin-top: 0.8rem;
  }

  .astro-box li {
    margin-bottom: 0.5rem;
  }

  .astro-meta {
    background-color: rgba(255,255,255,0.05);
    padding: 1.5rem;
    border-radius: 12px;
    margin-bottom: 2rem;
    font-size: 1rem;
  }

  .astro-meta p {
    margin: 0.4rem 0;
  }

  .celestial-signatures {
    background-color: rgba(255,255,255,0.05);
    padding: 1.5rem;
    border-radius: 12px;
    margin-top: 2.5rem;
    font-size: 1rem;
  }

  .celestial-signatures ul {
    list-style-type: disc;
    margin-top: 1rem;
    padding-left: 1.5rem;
  }

  .celestial-signatures li {
    margin-bottom: 0.5rem;
  }

  .btn-primary {
    background-color: #d4af37;
    color: #0b1f36;
    padding: 0.9rem 1.5rem;
    border-radius: 10px;
    font-weight: bold;
    text-decoration: none;
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    transition: background-color 0.3s ease;
    max-width: 100%;
  }

  .btn-primary:hover {
    background-color: #c49e2c;
  }

  .btn-container {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    align-items: center;
    margin-top: 2rem;
  }

  .plan-30dias {
    background-color: #fef3c7;
    color: #4b2e00;
    padding: 1.8rem;
    border-radius: 12px;
    margin-top: 2rem;
    font-weight: 500;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    line-height: 1.8;
  }
  .plan-30dias h4 {
    color: #b45309;
  }
</style>

<div class="astro-box">
  <div style="text-align: center;">
    <img src="{{ url_for('static', filename='img/logo_skyai.png') }}" alt="SkyAI Logo" style="max-height: 60px; margin-bottom: 1rem;">
    <h2>Your Personalized Astral Report</h2>
  </div>

  {% if resultado.erro %}
    <div class="flash error" style="margin-top: 1rem;">
      ⚠️ We couldn't complete your astral reading with AI at this moment. Showing fallback information instead.<br>
      <strong>Error Details:</strong> {{ resultado.erro }}
    </div>
  {% endif %}

  <div class="astro-meta">
    <p><strong>🌟 Full Name:</strong> {{ resultado.nome or '—' }}</p>
    <p><strong>🗓️ Date of Birth:</strong> {{ resultado.birth_date or '—' }}</p>
    <p><strong>🕰️ Time of Birth:</strong> {{ resultado.birth_time or '—' }}</p>
    <p><strong>🌍 Birth City:</strong> {{ resultado.birth_city or '—' }}</p>
    <p><strong>🌎 Country:</strong> {{ resultado.birth_country or '—' }}</p>
  </div>

  <div class="section">
    <h3>🌟 Cosmic Insights</h3>
    {% set blocos = resultado.texto.split('## ') %}
    {% for bloco in blocos %}
      {% set texto = bloco.strip() %}
      {% if texto %}
        {% set partes = texto.split(':', 1) %}
        {% set titulo = partes[0]|trim %}
        {% set conteudo = partes[1]|trim if partes|length > 1 else texto %}
        {% if '30-Day Action Plan' in titulo %}
          <div class="plan-30dias">
            <h4>{{ titulo }}</h4>
            <p>{{ conteudo }}</p>
          </div>
        {% else %}
          <div class="ai-summary-item" style="margin-bottom: 1.5rem;">
            {% if partes|length > 1 and titulo|length < 70 %}
              <h4>{{ titulo }}</h4>
              <p>{{ conteudo }}</p>
            {% else %}
              <p>{{ texto }}</p>
            {% endif %}
          </div>
        {% endif %}
      {% endif %}
    {% endfor %}
  </div>

  <div class="celestial-signatures">
    <h3>🔍 Your Celestial Signatures</h3>
    <ul>
      <li><strong>Sun Sign:</strong> {{ resultado.sun_sign or '—' }}</li>
      <li><strong>Moon Sign:</strong> {{ resultado.moon_sign or '—' }}</li>
      <li><strong>Ascendant:</strong> {{ resultado.ascendant or '—' }}</li>
      <li><strong>Life Path Number:</strong> {{ resultado.life_path or '—' }}</li>
      <li><strong>Soul Urge Number:</strong> {{ resultado.soul_urge or '—' }}</li>
      <li><strong>Expression Number:</strong> {{ resultado.expression or '—' }}</li>
    </ul>
  </div>

  <div class="btn-container">
    <a href="{{ url_for('user.relatorio_pdf', sessao_id=sessao_id) }}" class="btn-primary" target="_blank">
      📅 Download Astral Report (PDF)
    </a>

    <a href="{{ url_for('auth_views.dashboard') }}" class="btn-primary">
      ← Back to Your Cosmic Dashboard
    </a>
  </div>

  <div style="margin-top: 2rem; text-align: center;">
    <p style="font-size: 0.9rem; color: #bbb; text-align: center;">
      Generated by SkyAI • © {{ current_year }}
    </p>
  </div>
</div>
{% endblock %}
