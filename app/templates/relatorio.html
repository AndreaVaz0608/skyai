{% extends "base.html" %}
{% block title %}Informe astral â€¢ SkyAI{% endblock %}
{% block body_class %}report-page{% endblock %}

{% block content %}
<style>
  .astro-box {
    max-width: 900px;
    margin: 2.5rem auto;
    padding: 2.5rem;
    background: #0b1f36;
    color: white;
    border-radius: 20px;
    box-shadow: 0 12px 28px rgba(0, 0, 0, 0.1);
    line-height: 1.7;
  }

  .astro-box h2 { color: #d4af37; font-size: 1.8rem; margin-bottom: 1.5rem; text-align: center; }
  .astro-box h3 { color: #ffdd77; margin-top: 2rem; font-size: 1.3rem; }
  .astro-box h4 { color: #FCE495; margin-top: 1.25rem; font-size: 1.1rem; }

  .astro-meta, .celestial-signatures {
    background-color: rgba(255,255,255,0.05);
    padding: 1.5rem;
    border-radius: 12px;
    margin-bottom: 2rem;
    font-size: 1rem;
  }

  .btn-primary {
    background-color: #d4af37; color: #0b1f36; padding: 0.9rem 1.5rem; border-radius: 10px;
    font-weight: bold; text-decoration: none; text-align: center;
    transition: background-color 0.3s ease;
    max-width: 100%;
  }

  .btn-primary:hover { background-color: #c49e2c; }

  .plan-30dias {
    background-color: rgba(0,100,255,0.15); color: #ffeb3b;
    padding: 1.8rem; border-radius: 12px; margin-top: 2rem;
    font-weight: 600; box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    line-height: 1.8;
  }

</style>

<div class="astro-box">
  <div style="text-align: center;">
    <img src="{{ url_for('static', filename='img/logo_skyai.png') }}" alt="Logo de SkyAI" style="max-height: 60px; margin-bottom: 1rem;">
    <h2>Tu Informe Astral Personalizado</h2>
  </div>

  {% if resultado.erro %}
    <div class="flash error" style="margin-top: 1rem;">
      âš ï¸ No pudimos completar tu lectura astral con IA en este momento. Mostrando informaciÃ³n de respaldo.<br>
      <strong>Detalles del error:</strong> {{ resultado.erro }}
    </div>
  {% endif %}

  <div class="astro-meta">
    <p><strong>ğŸŒŸ Nombre completo:</strong> {{ resultado.nome or 'â€”' }}</p>
    <p><strong>ğŸ—“ï¸ Fecha de nacimiento:</strong> {{ resultado.birth_date or 'â€”' }}</p>
    <p><strong>ğŸ•°ï¸ Hora de nacimiento:</strong> {{ resultado.birth_time or 'â€”' }}</p>
    <p><strong>ğŸŒ Ciudad de nacimiento:</strong> {{ resultado.birth_city or 'â€”' }}</p>
    <p><strong>ğŸŒ PaÃ­s:</strong> {{ resultado.birth_country or 'â€”' }}</p>
  </div>

  <div class="section">
    <h3>ğŸŒŸ Perspectivas cÃ³smicas</h3>
    {% set blocos = resultado.texto.split('## ') %}
    {% set plano_renderizado = false %}

    {% for bloco in blocos %}
      {% set texto = bloco.strip() %}
      {% if texto %}
        {% set partes = texto.split(':', 1) %}
        {% set titulo = partes[0]|trim %}
        {% set conteudo = partes[1]|trim if partes|length > 1 else texto %}

        {% if 'âœ¨ Exclusive 30-Day Action Plan' in titulo %}
          {% if not plano_renderizado %}
            <div class="plan-30dias">
              <h4>{{ titulo }}</h4>
              <p>{{ conteudo }}</p>
            </div>
            {% set plano_renderizado = true %}
          {% endif %}
        {% else %}
          <div class="ai-summary-item" style="margin-bottom: 1.5rem;">
            {% if partes|length > 1 and titulo|length < 70 %}
              <h4>{{ titulo }}</h4>
              <p>{{ conteudo }}</p>
            {% else %}
              <p>{{ texto }}</p>
            {% endif %}
          </div>
        {% endif %}
      {% endif %}
    {% endfor %}
  </div>

  <div class="celestial-signatures">
    <h3>ğŸ” Tus Firmas Celestiales</h3>
    <ul>
      <li><strong>Signo solar:</strong> {{ resultado.sun_sign or 'â€”' }}</li>
      <li><strong>Signo lunar:</strong> {{ resultado.moon_sign or 'â€”' }}</li>
      <li><strong>Ascendente:</strong> {{ resultado.ascendant or 'â€”' }}</li>
      <li><strong>NÃºmero de Camino de Vida:</strong> {{ resultado.life_path or 'â€”' }}</li>
      <li><strong>NÃºmero de Anhelo del Alma:</strong> {{ resultado.soul_urge or 'â€”' }}</li>
      <li><strong>NÃºmero de ExpresiÃ³n:</strong> {{ resultado.expression or 'â€”' }}</li>
    </ul>
  </div>

  <div style="text-align: center; margin-top: 2rem;">
    <a href="{{ url_for('user.relatorio_pdf', sessao_id=sessao_id) }}" class="btn-primary" target="_blank">
      ğŸ“… Descargar Informe Astral (PDF)
    </a>
    <br><br>
    <a href="{{ url_for('auth_views.dashboard') }}" class="btn-primary">
      â† Volver a tu Panel CÃ³smico
    </a>
  </div>

  <div style="margin-top: 2rem; text-align: center;">
    <p style="font-size: 0.9rem; color: #bbb;">
      Generado por SkyAI â€¢ Â© {{ current_year }}
    </p>
  </div>
</div>
{% endblock %}
